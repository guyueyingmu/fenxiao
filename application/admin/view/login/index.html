<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="/static/admin/lib/element-ui/index.css">
    <style>
         [v-cloak]{
             display: none;
         }
    
    </style>
    <title>登录</title>
</head>

<body>
    <div id="app" v-cloak="">
        <div class="login">
            <el-row type="flex">
                <el-col :span="10" style="padding: 20% 0 0;margin: auto">
                    <el-form label-width="100px" class="demo-ruleForm">
                        <el-form-item label="用户名">
                            <el-input type="text" v-model="form.user_name" auto-complete="off"></el-input>
                        </el-form-item>
                        <el-form-item label="密码">
                            <el-input type="password" v-model="form.password" auto-complete="off"></el-input>
                        </el-form-item>
                        <el-form-item label="验证码">
                               <el-input  style=" vertical-align: middle;width: 120px" type="text" v-model="form.verify" auto-complete="off"></el-input>
                               <img onclick="get_verify()" id="captcha_img" src="{:captcha_src()}" width="100" height="36" alt="" style=" vertical-align: middle;"> 
                            </el-form-item>


                        <el-form-item>
                            <el-button type="primary" @click="submitForm('form')">登录</el-button>

                        </el-form-item>
                    </el-form>
                </el-col>
            </el-row>
        </div>
    </div>
</body>
<!-- 先引入 Vue -->
<script src="/static/admin/lib/vue.min.js"></script>
<script src="/static/admin/lib/vue-resource.min.js"></script>
<!-- 引入组件库 -->
<script src="/static/admin/lib/element-ui/index.js"></script>
<script>
    function get_verify(){
        document.getElementById('captcha_img').src="{:captcha_src()}?r="+Math.random();
    }
    
    Vue.http.options.emulateJSON = true;
    new Vue({
        el: '#app',
        data: {
            form: {
                user_name:'',
                password: '',
                verify:''
            },
            verify_img:'',
        },
        methods: {
            submitForm() {
                let url = '/admin/login/log_in',
                    data = this.form
                this.$http.post(url, data).then(function (res) { console.log(res.body.url);
                    if(res.body.code == 1){
                        this.$message.success(res.body.msg);
                        location.href=res.body.url;
                    }else{
                        this.$message.error(res.body.msg);
                    }
                }, function (err) {
                    this.$message.error(err.status + ',' + err.statusText);
                })
            }
        }
    })
</script>

</html>